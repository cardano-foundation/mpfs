"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[5441],{4791:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"manual/signingless","title":"Signingless MPFS Manual","description":"Introduction","source":"@site/docs/manual/signingless.md","sourceDirName":"manual","slug":"/manual/signingless","permalink":"/mpfs/docs/manual/signingless","draft":false,"unlisted":false,"editUrl":"https://github.com/cardano-foundation/mpfs/tree/main/docs/docs/manual/signingless.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"System architecture","permalink":"/mpfs/docs/architecture"}}');var a=t(4848),i=t(8453);const r={},o="Signingless MPFS Manual",c={},l=[{value:"Introduction",id:"introduction",level:2},{value:"Preprod wallet setup (optional)",id:"preprod-wallet-setup-optional",level:2},{value:"Wallet creation",id:"wallet-creation",level:3},{value:"Address funding",id:"address-funding",level:3},{value:"Manual library",id:"manual-library",level:2},{value:"Wait for a transaction",id:"wait-for-a-transaction",level:3},{value:"Sign and submit a transaction",id:"sign-and-submit-a-transaction",level:3},{value:"Inspect the current token",id:"inspect-the-current-token",level:3},{value:"Token boot",id:"token-boot",level:2},{value:"Requesting changes",id:"requesting-changes",level:2},{value:"Request to insert a fact",id:"request-to-insert-a-fact",level:3},{value:"Retracting a request",id:"retracting-a-request",level:3},{value:"Processing a request",id:"processing-a-request",level:3},{value:"Request to update a fact",id:"request-to-update-a-fact",level:2},{value:"Request to delete a fact",id:"request-to-delete-a-fact",level:2},{value:"Deleting a token",id:"deleting-a-token",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"signingless-mpfs-manual",children:"Signingless MPFS Manual"})}),"\n",(0,a.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,a.jsx)(n.p,{children:"This document provides a detailed manual for the signingless version of the Merkle Patricia Forestry Service (MPFS).\nIt is intended for users who want a service that is able to create and balance transactions and delegate the signing to the user.\nThe tipical interaction is getting the intended cbor for the user goal, sign it locally with a wallet and submit it to the network.\nThe API is public, no need to authenticate to use it and so it's the operator responsibility to protect it from ddos attacks.\nIn particular it exposes universally useful end-points, like submitting any transaction."}),"\n",(0,a.jsx)(n.p,{children:"For the time being only preprod setup is available."}),"\n",(0,a.jsxs)(n.p,{children:["A preprod public instance is running at ",(0,a.jsx)(n.a,{href:"https://mpfs.plutimus.com",children:"https://mpfs.plutimus.com"}),", free to use, but with no guarantee of availability. Cardano is a permissionless public network, so anyone can (should) run their own instance of the service."]}),"\n",(0,a.jsx)(n.p,{children:"For the rest of the manual we suppose the user has control of an address which we will refer to as $ADDR, and that the user has a wallet that can sign transactions spending from that address."}),"\n",(0,a.jsx)(n.p,{children:"In the repository it's included a simple wallet functionality which we will use for the sake of getting thinks done."}),"\n",(0,a.jsx)(n.h2,{id:"preprod-wallet-setup-optional",children:"Preprod wallet setup (optional)"}),"\n",(0,a.jsx)(n.h3,{id:"wallet-creation",children:"Wallet creation"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/paolino/mpfs.git\ncd mpfs/off_chain\nmkdir tmp\nnpx tsx src/service/wallet.ts create-wallet tmp/test.json\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Now you have some menmonics in ",(0,a.jsx)(n.code,{children:"tmp/test.json"})," file, you can use them to sign transactions."]}),"\n",(0,a.jsx)(n.h3,{id:"address-funding",children:"Address funding"}),"\n",(0,a.jsxs)(n.p,{children:["You can get some test ada to your address using the ",(0,a.jsx)(n.a,{href:"https://faucet.preprod.cardano.org/",children:"Cardano Preprod Faucet"}),"."]}),"\n",(0,a.jsx)(n.p,{children:"Get your address with"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"ADDR=$(npx tsx src/service/wallet.ts reveal-address tmp/test.json | jq -r '.address')\necho $ADDR\nexport ADDR\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Goto ",(0,a.jsx)(n.a,{href:"https://docs.cardano.org/cardano-testnets/tools/faucet",children:"Faucets"})," paste your address and select preprod."]}),"\n",(0,a.jsx)(n.p,{children:"After several seconds (20 on average, up to minutes) your address will contain a UTxO with 10000 tAda\nYou can verify it on an explorer."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'brave "https://preprod.cardanoscan.io/address/$ADDR"\n'})}),"\n",(0,a.jsx)(n.h2,{id:"manual-library",children:"Manual library"}),"\n",(0,a.jsx)(n.h3,{id:"wait-for-a-transaction",children:"Wait for a transaction"}),"\n",(0,a.jsx)(n.p,{children:"You can use the following command to wait for a transaction to be included in the blockchain:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'wait_for_tx() {\n  local txId=$1\n  while true; do\n    result=$(curl -s -X \'GET\' "https://mpfs.plutimus.com/transaction?txHash=$txId")\n    if [[ $result == *"404 Not Found"* ]]; then\n      echo "Transaction $txId not found, waiting..."\n      sleep 2\n    else\n      echo "Transaction $txId found!"\n      break\n    fi\n  done\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"sign-and-submit-a-transaction",children:"Sign and submit a transaction"}),"\n",(0,a.jsx)(n.p,{children:"This is the most common operation. Once you receive a CBOR encoded transaction from the service, you can sign it with your wallet and submit it to the network."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"\nsign_and_submit() {\n  local file=\"tmp/tx.cbor\"\n  local txId=$(npx tsx src/service/wallet.ts sign-transaction tmp/test.json $file)\n  result=$(curl -s -X 'POST' \\\n    \"https://mpfs.plutimus.com/transaction\" \\\n    -H 'accept: application/json' \\\n    -H 'Content-Type: application/json' \\\n    -d '{\"signedTransaction\":\"'\"$(cat $file)\"'\"}')\n  echo $result | jq -r '.txHash'\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"inspect-the-current-token",children:"Inspect the current token"}),"\n",(0,a.jsx)(n.p,{children:"You can inspect the current state of a token by its ID. This will return the token's root hash, owner, and other relevant information."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"inspect_token() {\n    local tokenId=$TOKEN_ID\n    result=$(curl -s -X 'GET' \\\n        \"https://mpfs.plutimus.com/token/$tokenId\" \\\n        -H 'accept: application/json')\n    echo $result | jq\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"token-boot",children:"Token boot"}),"\n",(0,a.jsx)(n.p,{children:"This transaction is meant to start a fresh MPF token. The requester goal is to become the owner of the token. As with all transaction endpoint the requester is supposed to pass an address where the service will select the necessary utxos for the fees."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"result=$(curl -s -X 'GET' \\\n  \"https://mpfs.plutimus.com/transaction/$ADDR/boot-token\" \\\n  -H 'accept: application/json')\n"})}),"\n",(0,a.jsx)(n.p,{children:"In the result you will find both the unsigned transaction and the token ID that will be created.\nYou can save the unsigned transaction to a file:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"echo $result | jq -r '.unsignedTransaction' > tmp/tx.cbor\n"})}),"\n",(0,a.jsx)(n.p,{children:"And export the token ID for the next steps:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"TOKEN_ID=$(echo $result | jq -r '.value')\necho \"Token ID: $TOKEN_ID\"\n"})}),"\n",(0,a.jsxs)(n.p,{children:["When using an untrusted instance you should inspect the unsigned transaction before signing it. You can do this by using the ",(0,a.jsx)(n.code,{children:"cardano-cli"})," tool or any other CBOR inspection tool. Better support will be added in the future, but in general it's a role of the application to validate contents before and after requesting a transaction to the ",(0,a.jsx)(n.code,{children:"mpfs"})," instance."]}),"\n",(0,a.jsx)(n.p,{children:"Now you can sign and submit the transaction:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'txId=$(sign_and_submit)\necho "Transaction ID: $txId"\n'})}),"\n",(0,a.jsx)(n.p,{children:"And wait for it to be included in the blockchain:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"wait_for_tx $txId\n"})}),"\n",(0,a.jsx)(n.p,{children:"You can can inspect the token state with:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"inspect_token\n"})}),"\n",(0,a.jsx)(n.p,{children:"Critically the token root is the empty hash and the owner is your public key hash.\nAlso notice the empty set of requests, meaning no change-requests have been made yet."}),"\n",(0,a.jsx)(n.h2,{id:"requesting-changes",children:"Requesting changes"}),"\n",(0,a.jsx)(n.p,{children:"For the sake of the manual we are not going to impersonate different roles, but you can imagine that requests for changes are made by different actors, which means different wallets, addresses and public key hashes. Specifically we are reusing ADDR env var and tmp/test.json mnemonics considering the token owner as requesting changes to himself."}),"\n",(0,a.jsx)(n.h3,{id:"request-to-insert-a-fact",children:"Request to insert a fact"}),"\n",(0,a.jsx)(n.p,{children:"A fact in this context is a key-value pair. MPFS impose no semantics so you are free to pass a json string for both. In case of binary data some encoding could be necessary, mpfs is not supporting any ATM."}),"\n",(0,a.jsx)(n.p,{children:"You can ask the owner to insert a fact with"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"result=$(curl -s -X 'POST' \\\n  \"https://mpfs.plutimus.com/transaction/$ADDR/request-insert/$TOKEN_ID\" \\\n  -H 'accept: application/json' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n  \"key\": \"exampleKey\",\n  \"value\": \"exampleValue\"\n   }')\necho $result | jq -r '.unsignedTransaction' > tmp/tx.cbor\ntxId=$(sign_and_submit)\nwait_for_tx $txId\n"})}),"\n",(0,a.jsx)(n.p,{children:"Let's store the first output reference of the transaction for later use inside retracting the request:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'OUTPUT_REF="$txId-0"\n'})}),"\n",(0,a.jsx)(n.p,{children:"Now you can inspect the token state again to see the request has been added:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"inspect_token | jq -r '.requests'\n"})}),"\n",(0,a.jsx)(n.p,{children:"As already mentioned, in this scenarion, the owner of the request is the same as the owner of the token.\nThe request owner is relevant when it comes to retracting it. With the current version of mpfs until the request is not processed, the owner can retract it, meaning that the request will be removed from the token state and no longer considered for processing."}),"\n",(0,a.jsx)(n.h3,{id:"retracting-a-request",children:"Retracting a request"}),"\n",(0,a.jsx)(n.p,{children:"The owner of the request can retract it with"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"result=$(curl -s -X 'GET' \\\n  \"https://mpfs.plutimus.com/transaction/$ADDR/retract-change/$OUTPUT_REF\"\n  )\necho $result | jq -r '.unsignedTransaction' > tmp/tx.cbor\ntxId=$(sign_and_submit)\nwait_for_tx $txId\n"})}),"\n",(0,a.jsx)(n.p,{children:"Now inspecting the token will show that the request has been removed:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"inspect_token | jq -r '.requests'\n"})}),"\n",(0,a.jsx)(n.h3,{id:"processing-a-request",children:"Processing a request"}),"\n",(0,a.jsx)(n.p,{children:"Let's re-create the request to insert a fact, but this time we will process it."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"result=$(curl -s -X 'POST' \\\n  \"https://mpfs.plutimus.com/transaction/$ADDR/request-insert/$TOKEN_ID\" \\\n  -H 'accept: application/json' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n  \"key\": \"exampleKey\",\n  \"value\": \"exampleValue\"\n   }')\necho $result | jq -r '.unsignedTransaction' > tmp/tx.cbor\ntxId=$(sign_and_submit)\nwait_for_tx $txId\n"})}),"\n",(0,a.jsx)(n.p,{children:"Now as token owner we can process it into the token state with"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"\nOUTPUT_REF=\"$txId-0\"\nresult=$(curl -s -X 'GET' \\\n  \"https://mpfs.plutimus.com/transaction/$ADDR/update-token/$TOKEN_ID?request=$OUTPUT_REF\" \\\n  -H 'accept: application/json'\n  )\necho $result | jq -r '.unsignedTransaction' > tmp/tx.cbor\ntxId=$(sign_and_submit)\nwait_for_tx $txId\n"})}),"\n",(0,a.jsx)(n.p,{children:"Now inspecting the token will show that the request has been processed as the state is not the empty hash:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"inspect_token | jq -r '.state.root'\n"})}),"\n",(0,a.jsx)(n.p,{children:"Moreover the mpfs service is storing the facts of each token by indexing the blockchain so we can query them with"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"result=$(curl -s -X 'GET' \\\n  \"https://mpfs.plutimus.com/token/$TOKEN_ID/facts\" \\\n  -H 'accept: application/json' \\\n  -H 'Content-Type: application/json' \\\n  )\necho $result | jq\n"})}),"\n",(0,a.jsx)(n.h2,{id:"request-to-update-a-fact",children:"Request to update a fact"}),"\n",(0,a.jsx)(n.p,{children:"Anyone can request to update a fact by requesting an update to the existing key-value pair. The request is similar to the insert request, but it will update the value of an existing key."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'result=$(curl -s -X \'POST\' \\\n  "https://mpfs.plutimus.com/transaction/$ADDR/request-update/$TOKEN_ID" \\\n  -H \'accept: application/json\' \\\n  -H \'Content-Type: application/json\' \\\n  -d \'{\n  "key": "exampleKey",\n  "oldValue": "exampleValue",\n  "newValue": "newExampleValue"\n   }\')\necho $result | jq -r \'.unsignedTransaction\' > tmp/tx.cbor\ntxId=$(sign_and_submit)\nwait_for_tx $txId\n'})}),"\n",(0,a.jsx)(n.p,{children:"The token owner can process the request in the same way as before:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"OUTPUT_REF=\"$txId-0\"\nresult=$(curl -s -X 'GET' \\\n  \"https://mpfs.plutimus.com/transaction/$ADDR/update-token/$TOKEN_ID?request=$OUTPUT_REF\" \\\n  -H 'accept: application/json'\n  )\necho $result | jq -r '.unsignedTransaction' > tmp/tx.cbor\ntxId=$(sign_and_submit)\nwait_for_tx $txId\n"})}),"\n",(0,a.jsx)(n.p,{children:"Now inspecting the facts at 'exampleKey' will show the updated value:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"result=$(curl -s -X 'GET' \\\n  \"https://mpfs.plutimus.com/token/$TOKEN_ID/facts\" \\\n  -H 'accept: application/json' \\\n  -H 'Content-Type: application/json' \\\n  )\necho $result | jq -r '.exampleKey'\n"})}),"\n",(0,a.jsx)(n.h2,{id:"request-to-delete-a-fact",children:"Request to delete a fact"}),"\n",(0,a.jsx)(n.p,{children:"Anyone can request to delete a fact by requesting a deletion of the key-value pair. The request is similar to the insert request, but it will remove the key from the token state."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"result=$(curl -s -X 'POST' \\\n  \"https://mpfs.plutimus.com/transaction/$ADDR/request-delete/$TOKEN_ID\" \\\n  -H 'accept: application/json' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n  \"key\": \"exampleKey\"\n  , \"value\": \"newExampleValue\"\n   }')\necho $result | jq -r '.unsignedTransaction' > tmp/tx.cbor\ntxId=$(sign_and_submit)\nwait_for_tx $txId\n"})}),"\n",(0,a.jsx)(n.p,{children:"The token owner can process the request in the same way as before:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"OUTPUT_REF=\"$txId-0\"\nresult=$(curl -s -X 'GET' \\\n  \"https://mpfs.plutimus.com/transaction/$ADDR/update-token/$TOKEN_ID?request=$OUTPUT_REF\" \\\n  -H 'accept: application/json')\necho $result | jq -r '.unsignedTransaction' > tmp/tx.cbor\ntxId=$(sign_and_submit)\nwait_for_tx $txId\n"})}),"\n",(0,a.jsx)(n.p,{children:"Now facts will not contain the deleted key:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"result=$(curl -s -X 'GET' \\\n  \"https://mpfs.plutimus.com/token/$TOKEN_ID/facts\" \\\n  -H 'accept: application/json' \\\n  -H 'Content-Type: application/json' \\\n  )\necho $result | jq\n"})}),"\n",(0,a.jsx)(n.p,{children:"And the token state will be back to a null hash"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"inspect_token | jq -r '.state.root'\n"})}),"\n",(0,a.jsx)(n.h2,{id:"deleting-a-token",children:"Deleting a token"}),"\n",(0,a.jsx)(n.p,{children:"The owner of the token can delete the token making impossible to refer to its facts in other smart contracts with"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"result=$(curl -s -X 'GET' \\\n  \"https://mpfs.plutimus.com/transaction/$ADDR/end-token/$TOKEN_ID\" \\\n  -H 'accept: application/json')\necho $result | jq -r '.unsignedTransaction' > tmp/tx.cbor\ntxId=$(sign_and_submit tmp/tx.cbor)\nwait_for_tx $txId\n"})}),"\n",(0,a.jsx)(n.p,{children:"And that's it, the token is deleted and its facts are no longer accessible."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"inspect_token\n}\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}}}]);